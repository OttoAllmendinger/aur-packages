# Maintainer: Otto Allmendinger <otto.allmendinger@gmail.com>

pkgname=grooveshark-desktop
pkgver=20100831.08
pkgrel=:
pkgdesc="Grooveshark desktop client for VIP users using adobe-air"
arch=("i686" "x86_64")
url="http://vip.grooveshark.com/summary"
license=("unknown")
makedepends=("unzip")

if [ "${CARCH}" == "x86_64" ]; then
    _air_depend="bin32-adobe-air"
elif [ "${CARCH}" == "i686" ]; then
    _air_depend="adobe-air"
fi

depends=("${_air_depend}" "hicolor-icon-theme" "xdg-utils")

source=(
    "http://preview.grooveshark.com/desktop/GSDesktop_${pkgver}.air"
    "grooveshark-desktop.sh" "grooveshark.desktop")
install=grooveshark-desktop.install



md5sums=('60bb6cb9f21f92df12583dd5f5cecf24'
         'b29b998d00b73e254db3124a3dcb607d'
         '5da56775f4123e3eaf6205c4bf7412ec')

build() {
    _builddir=${srcdir}/grooveshark-desktop-${pkgver}
    _filename="GSDesktop_${pkgver}.air"


    rm -rf ${_builddir}
    mkdir ${_builddir}


    unzip ${_filename} -d ${_builddir} > /dev/null || exit 1

    cd ${srcdir}/

    #install -d ${pkgdir}/usr/bin
    #install -d ${pkgdir}/opt/${pkgname}
    
    ## main files
    install -D ${_filename} ${pkgdir}/opt/${pkgname}/grooveshark-desktop.air

    ## desktop launcher
    install -Dm644 "grooveshark.desktop" \
        ${pkgdir}/usr/share/applications/grooveshark.desktop || exit 1

    for s in 16 32 48 128; do
        install -Dm644 ${_builddir}/icons/gs${s}.png \
            ${pkgdir}/usr/share/icons/hicolor/${s}x${s}/apps/grooveshark-desktop.png || exit 1
    done

    ## launch script
    install -Dm755 "grooveshark-desktop.sh" \
        ${pkgdir}/usr/bin/grooveshark-desktop
}
