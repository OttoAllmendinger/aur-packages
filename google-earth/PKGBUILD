# PKGBUILD by Berseker <berseker86@gmail.com>
# Based mostly on the great bin32-google-earth PKGBUILD by srabd

_use_arch_libs="no" # Change to "no" if you want to use provided-by-Google libraries instead of provided-by-Arch ones.

pkgname=google-earth
pkgver=5.2.1.1588
pkgrel=1
pkgdesc="A 3D interface to the planet Earth"
url="http://earth.google.com"
license=('custom')
depends=('curl' 'qt')
install=googleearth.install



conflicts=('bin32-google-earth')
source=(http://dl.google.com/earth/client/current/GoogleEarthLinux.bin http://earth.google.com/intl/en/license.html googleearth googleearth.desktop 
googleearth-mimetypes.xml googleearth.install qt.conf)
arch=('i686')

_libs_to_remove="libcurl.so.4 libGLU.so.1 libQtCore.so.4 libQtGui.so.4 libQtNetwork.so.4 libQtWebKit.so.4"

build() {
	cd ${startdir}/src

	# Extract archive
	sh ./GoogleEarthLinux.bin --noexec --target ${startdir}/src/${pkgname} || return 1

	# Install binaries and data files
	mkdir -p ${pkgdir}/opt/${pkgname}
	tar -xpf ${srcdir}/${pkgname}/googleearth-linux-x86.tar -C ${pkgdir}/opt/${pkgname}/ || return 1
	tar -xpf ${srcdir}/${pkgname}/googleearth-data.tar -C ${pkgdir}/opt/${pkgname}/ || return 1

	# Install executable
	install -D -m755 ${srcdir}/googleearth ${pkgdir}/usr/bin/googleearth || return 1

	# Install .desktop file
	install -D -m644 ${startdir}/src/googleearth.desktop ${startdir}/pkg/usr/share/applications/googleearth.desktop || return 1

	# Install shared MIME info package
	install -D -m644 ${startdir}/src/googleearth-mimetypes.xml ${startdir}/pkg/usr/share/mime/packages/googleearth-mimetypes.xml || return 1

	# Install icon
	install -D -m644 ${startdir}/src/${pkgname}/googleearth-icon.png ${startdir}/pkg/usr/share/pixmaps/googleearth-icon.png || return 1
	
	# Install license
	install -D -m644 ${startdir}/src/license.html ${startdir}/pkg/usr/share/licenses/${pkgname}/license.html || return 1

	# Change ownership to root
	chown -R root:root ${startdir}/pkg/* || return 1

	# Removing provided libraries to use Arch ones (only if _use_arch_libs is set to "yes")
	if [ "${_use_arch_libs}" == "yes" ]; then
		cd ${pkgdir}/opt/${pkgname} || return 1
		rm ${_libs_to_remove} || return 1
		install -D -m644 ${srcdir}/qt.conf ${pkgdir}/opt/${pkgname}/qt.conf
	fi
}

md5sums=('19ccb5dff2b1165c2a3644cbf6d680ee'
         '757d9726191f365209fa13acdd0ab6e7'
         '0b3b5632f7bea896f74a43a8c16d0934'
         'd819a1961382826b7f92ee32dd67f2e1'
         '84e1efd656f86c52333cc629b31accb0'
         '2922f8668ae19e6d9c558aaadda90af8'
         '80a783c71b7f0b5c7161cef467801147')
